{"version":3,"file":"kiss-vuex.js","sources":["../src/Store.js"],"sourcesContent":["import Vue from \"vue\";\nimport Vuex from \"vuex\";\n\nlet vuexHasUsed = false;\n\nfunction __normalizePath__(path) {\n    const finalPaths = [];\n    if (typeof path === \"string\") {\n        path = path.split(\".\");\n    }\n    if (Array.isArray(path) && path.length) {\n        for (let p of path) {\n            if (p || p == 0) {\n                finalPaths.push(p);\n            }\n        }\n    }\n    return finalPaths;\n}\n\nfunction __set__(object, path, value) {\n    if (object && typeof object === \"object\") {\n        path = __normalizePath__(path);\n        const length = path.length;\n        for (let i = 0; i < length; i++) {\n            if (i >= length - 1) {\n                object[path[i]] = value;\n            } else if (typeof object[path[i]] === \"object\") {\n                object = object[path[i]];\n            } else if (object[path[i]] == null) {\n                object = object[path[i]] = {};\n            } else {\n                break;\n            }\n        }\n    }\n}\n\nfunction __get__(object, path) {\n    let result = void 0;\n    if (object && typeof object === \"object\") {\n        path = __normalizePath__(path);\n        const length = path.length;\n        for (let i = 0; i < length; i++) {\n            if (i >= length - 1) {\n                result = object[path[i]];\n            } else if (typeof object[path[i]] === \"object\") {\n                object = object[path[i]];\n            }\n        }\n    }\n    return result;\n}\n\nfunction genCommitName(key) {\n    if (key && typeof key === \"string\") {\n        return \"SETTER_\" + key.toUpperCase();\n    }\n    return \"\";\n}\n\nfunction getFromStore(store, key) {\n    return __get__(store.state, key);\n}\n\nfunction setToStore(store, key, data) {\n    const firstKey = getFirstKey(key),\n        commitName = genCommitName(firstKey);\n    return store.commit(commitName, { data, path: key });\n}\n\nfunction getFirstKey(key) {\n    return __normalizePath__(key)[0];\n}\n\nfunction initVuexStore(object, keys) {\n    keys = keys || Object.keys(Object(object));\n    let store = null;\n    if (keys && keys.length) {\n        const state = {},\n            mutations = {};\n        for (let key of keys) {\n            state[key] = object[key];\n            let commitName = genCommitName(key);\n            mutations[commitName] = function(state, options = {}) {\n                let path = options.path || key,\n                    data = options.data || null;\n                path = path || key;\n                if (hasOwnProperty.call(options, \"data\")) {\n                    __set__(state, path, data);\n                }\n            };\n        }\n        store = new Vuex.Store({ state, mutations });\n    }\n    return store;\n}\n\nfunction makeStore(object) {\n    object = Object(object);\n    const keys = Object.keys(object),\n        store = initVuexStore(object, keys),\n        castReactive = function castReactive(key) {\n            Object.defineProperty(object, key, {\n                get() {\n                    return getFromStore(store, key);\n                },\n                set(newVal) {\n                    setToStore(store, key, newVal);\n                }\n            });\n        };\n    for (let key of keys) {\n        castReactive(key);\n    }\n    return object;\n}\n\nfunction makeClassStore(targetClass) {\n    const targetObj = new targetClass(),\n        store = makeStore(targetObj);\n    const Class = function Class() {\n        for (let prop of Object.keys(targetObj)) {\n            Object.defineProperty(\n                this,\n                prop,\n                Object.getOwnPropertyDescriptor(targetObj, prop)\n            );\n        }\n    };\n    Class.prototype = Object.create(targetClass.prototype);\n    Class.prototype.constructor = targetClass.prototype.constructor;\n    return Class;\n}\n\nfunction makeObjectStore(options) {\n    return makeStore(options);\n}\n\nfunction Store(options = {}) {\n    if (!vuexHasUsed) {\n        Vue.use(Vuex);\n        vuexHasUsed = true;\n    }\n    if (typeof options === \"function\") {\n        return makeClassStore(options);\n    } else {\n        return makeObjectStore(options);\n    }\n}\n\nexport default Store;\n"],"names":["vuexHasUsed","__normalizePath__","path","finalPaths","split","Array","isArray","length","p","push","__set__","object","value","i","__get__","result","genCommitName","key","toUpperCase","getFromStore","store","state","setToStore","data","firstKey","getFirstKey","commitName","commit","initVuexStore","keys","Object","mutations","options","hasOwnProperty","call","Vuex","Store","makeStore","castReactive","defineProperty","get","set","newVal","makeClassStore","targetClass","targetObj","Class","prop","getOwnPropertyDescriptor","prototype","create","constructor","makeObjectStore","Vue","use"],"mappings":"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"}