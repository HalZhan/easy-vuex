{"version":3,"file":"kiss-vuex.js","sources":["../src/Store.js"],"sourcesContent":["import Vue from \"vue\";\nimport Vuex from \"vuex\";\n\nlet vuexHasUsed = false;\n\nfunction __isKey__(path) {\n    return [\"string\", \"number\", \"symbol\", \"bigint\"].indexOf(typeof path) > -1;\n}\n\nfunction __normalizePath__(path) {\n    let finalPaths = [];\n    if (__isKey__(path)) {\n        path = String(path)\n            .replace(\"[\", \".\")\n            .replace(\"]\", \".\")\n            .split(\".\");\n    }\n    if (Array.isArray(path) && path.length) {\n        for (let p of path) {\n            if (p.indexOf(\".\") > -1) {\n                finalPaths = finalPaths.concat(__normalizePath__(p));\n            } else if (p || p == \"0\") {\n                finalPaths.push(p);\n            }\n        }\n    }\n    return finalPaths;\n}\n\nfunction __set__(object, path, value) {\n    const rawObj = object;\n    if (object && typeof object === \"object\") {\n        path = __normalizePath__(path);\n        const length = path.length;\n        for (let i = 0; i < length; i++) {\n            if (i >= length - 1) {\n                object[path[i]] = value;\n            } else if (typeof object[path[i]] === \"object\") {\n                object = object[path[i]];\n            } else {\n                object = object[path[i]] = {};\n            }\n        }\n    }\n    return rawObj;\n}\n\nfunction __get__(object, path) {\n    let result = void 0;\n    if (object && typeof object === \"object\") {\n        path = __normalizePath__(path);\n        const length = path.length;\n        if (length) {\n            for (let i = 0; i < length; i++) {\n                if (i >= length - 1) {\n                    result = object[path[i]];\n                } else if (typeof object[path[i]] === \"object\") {\n                    object = object[path[i]];\n                }\n            }\n        }\n    }\n    return result;\n}\n\nfunction genCommitName(key) {\n    if (__isKey__(key)) {\n        return \"SETTER_\" + String(key).toUpperCase();\n    }\n    return \"\";\n}\n\nfunction getFromStore(store, key) {\n    return __get__(store.state, key);\n}\n\nfunction setToStore(store, key, data) {\n    const firstKey = getFirstKey(key),\n        commitName = genCommitName(firstKey);\n    return store.commit(commitName, { data, path: key });\n}\n\nfunction getFirstKey(key) {\n    return __normalizePath__(key)[0];\n}\n\nfunction initVuexStore(object, keys) {\n    keys = keys || Object.keys(Object(object));\n    let store = null;\n    if (keys && keys.length) {\n        const state = {},\n            mutations = {};\n        for (let key of keys) {\n            state[key] = object[key];\n            let commitName = genCommitName(key);\n            mutations[commitName] = function(state, options = {}) {\n                let path = options.path || key,\n                    data = options.data || null;\n                path = path || key;\n                if (hasOwnProperty.call(options, \"data\")) {\n                    __set__(state, path, data);\n                }\n            };\n        }\n        store = new Vuex.Store({ state, mutations });\n    }\n    return store;\n}\n\nfunction makeStore(object) {\n    object = Object(object);\n    const keys = Object.keys(object),\n        store = initVuexStore(object, keys),\n        castReactive = function castReactive(key) {\n            Object.defineProperty(object, key, {\n                get() {\n                    return getFromStore(store, key);\n                },\n                set(newVal) {\n                    if (typeof newVal === \"object\") {\n                        newVal = Object.assign({}, newVal);\n                    }\n                    setToStore(store, key, newVal);\n                }\n            });\n        };\n    for (let key of keys) {\n        castReactive(key);\n    }\n    return store;\n}\n\nfunction makeClassStore(targetClass) {\n    const targetObj = new targetClass(),\n        store = makeStore(targetObj);\n    const Class = function Class() {\n        for (let prop of Object.keys(targetObj)) {\n            Object.defineProperty(\n                this,\n                prop,\n                Object.getOwnPropertyDescriptor(targetObj, prop)\n            );\n        }\n    };\n    Class.prototype = Object.create(targetClass.prototype);\n    Class.prototype.constructor = targetClass.prototype.constructor;\n    Class.__VUE_STORE__ = store;\n    return Class;\n}\n\nfunction makeObjectStore(options) {\n    makeStore(options);\n    return options;\n}\n\nfunction Store(options = {}) {\n    if (!vuexHasUsed) {\n        Vue.use(Vuex);\n        vuexHasUsed = true;\n    }\n    if (typeof options === \"function\") {\n        return makeClassStore(options);\n    } else {\n        return makeObjectStore(options);\n    }\n}\n\nexport {\n    __normalizePath__,\n    __set__,\n    __get__,\n    genCommitName,\n    getFromStore,\n    setToStore,\n    getFirstKey,\n    initVuexStore,\n    makeStore,\n    makeClassStore,\n    makeObjectStore\n};\n\nexport default Store;\n"],"names":["vuexHasUsed","__isKey__","path","indexOf","__normalizePath__","finalPaths","String","replace","split","Array","isArray","length","p","concat","push","__set__","object","value","rawObj","i","__get__","result","genCommitName","key","toUpperCase","getFromStore","store","state","setToStore","data","firstKey","getFirstKey","commitName","commit","initVuexStore","keys","Object","mutations","options","hasOwnProperty","call","Vuex","Store","makeStore","castReactive","defineProperty","get","set","newVal","assign","makeClassStore","targetClass","targetObj","Class","prop","getOwnPropertyDescriptor","prototype","create","constructor","__VUE_STORE__","makeObjectStore","Vue","use"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;EAGA,IAAIA,WAAW,GAAG,KAAlB;;EAEA,SAASC,SAAT,CAAmBC,IAAnB,EAAyB;EACrB,SAAO,CAAC,QAAD,EAAW,QAAX,EAAqB,QAArB,EAA+B,QAA/B,EAAyCC,OAAzC,SAAwDD,IAAxD,KAAgE,CAAC,CAAxE;EACH;;EAED,SAASE,iBAAT,CAA2BF,IAA3B,EAAiC;EAC7B,MAAIG,UAAU,GAAG,EAAjB;;EACA,MAAIJ,SAAS,CAACC,IAAD,CAAb,EAAqB;EACjBA,IAAAA,IAAI,GAAGI,MAAM,CAACJ,IAAD,CAAN,CACFK,OADE,CACM,GADN,EACW,GADX,EAEFA,OAFE,CAEM,GAFN,EAEW,GAFX,EAGFC,KAHE,CAGI,GAHJ,CAAP;EAIH;;EACD,MAAIC,KAAK,CAACC,OAAN,CAAcR,IAAd,KAAuBA,IAAI,CAACS,MAAhC,EAAwC;EAAA;EAAA;EAAA;;EAAA;EACpC,2BAAcT,IAAd,8HAAoB;EAAA,YAAXU,CAAW;;EAChB,YAAIA,CAAC,CAACT,OAAF,CAAU,GAAV,IAAiB,CAAC,CAAtB,EAAyB;EACrBE,UAAAA,UAAU,GAAGA,UAAU,CAACQ,MAAX,CAAkBT,iBAAiB,CAACQ,CAAD,CAAnC,CAAb;EACH,SAFD,MAEO,IAAIA,CAAC,IAAIA,CAAC,IAAI,GAAd,EAAmB;EACtBP,UAAAA,UAAU,CAACS,IAAX,CAAgBF,CAAhB;EACH;EACJ;EAPmC;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAQvC;;EACD,SAAOP,UAAP;EACH;;EAED,SAASU,OAAT,CAAiBC,MAAjB,EAAyBd,IAAzB,EAA+Be,KAA/B,EAAsC;EAClC,MAAMC,MAAM,GAAGF,MAAf;;EACA,MAAIA,MAAM,IAAI,QAAOA,MAAP,MAAkB,QAAhC,EAA0C;EACtCd,IAAAA,IAAI,GAAGE,iBAAiB,CAACF,IAAD,CAAxB;EACA,QAAMS,MAAM,GAAGT,IAAI,CAACS,MAApB;;EACA,SAAK,IAAIQ,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGR,MAApB,EAA4BQ,CAAC,EAA7B,EAAiC;EAC7B,UAAIA,CAAC,IAAIR,MAAM,GAAG,CAAlB,EAAqB;EACjBK,QAAAA,MAAM,CAACd,IAAI,CAACiB,CAAD,CAAL,CAAN,GAAkBF,KAAlB;EACH,OAFD,MAEO,IAAI,QAAOD,MAAM,CAACd,IAAI,CAACiB,CAAD,CAAL,CAAb,MAA2B,QAA/B,EAAyC;EAC5CH,QAAAA,MAAM,GAAGA,MAAM,CAACd,IAAI,CAACiB,CAAD,CAAL,CAAf;EACH,OAFM,MAEA;EACHH,QAAAA,MAAM,GAAGA,MAAM,CAACd,IAAI,CAACiB,CAAD,CAAL,CAAN,GAAkB,EAA3B;EACH;EACJ;EACJ;;EACD,SAAOD,MAAP;EACH;;EAED,SAASE,OAAT,CAAiBJ,MAAjB,EAAyBd,IAAzB,EAA+B;EAC3B,MAAImB,MAAM,GAAG,KAAK,CAAlB;;EACA,MAAIL,MAAM,IAAI,QAAOA,MAAP,MAAkB,QAAhC,EAA0C;EACtCd,IAAAA,IAAI,GAAGE,iBAAiB,CAACF,IAAD,CAAxB;EACA,QAAMS,MAAM,GAAGT,IAAI,CAACS,MAApB;;EACA,QAAIA,MAAJ,EAAY;EACR,WAAK,IAAIQ,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGR,MAApB,EAA4BQ,CAAC,EAA7B,EAAiC;EAC7B,YAAIA,CAAC,IAAIR,MAAM,GAAG,CAAlB,EAAqB;EACjBU,UAAAA,MAAM,GAAGL,MAAM,CAACd,IAAI,CAACiB,CAAD,CAAL,CAAf;EACH,SAFD,MAEO,IAAI,QAAOH,MAAM,CAACd,IAAI,CAACiB,CAAD,CAAL,CAAb,MAA2B,QAA/B,EAAyC;EAC5CH,UAAAA,MAAM,GAAGA,MAAM,CAACd,IAAI,CAACiB,CAAD,CAAL,CAAf;EACH;EACJ;EACJ;EACJ;;EACD,SAAOE,MAAP;EACH;;EAED,SAASC,aAAT,CAAuBC,GAAvB,EAA4B;EACxB,MAAItB,SAAS,CAACsB,GAAD,CAAb,EAAoB;EAChB,WAAO,YAAYjB,MAAM,CAACiB,GAAD,CAAN,CAAYC,WAAZ,EAAnB;EACH;;EACD,SAAO,EAAP;EACH;;EAED,SAASC,YAAT,CAAsBC,KAAtB,EAA6BH,GAA7B,EAAkC;EAC9B,SAAOH,OAAO,CAACM,KAAK,CAACC,KAAP,EAAcJ,GAAd,CAAd;EACH;;EAED,SAASK,UAAT,CAAoBF,KAApB,EAA2BH,GAA3B,EAAgCM,IAAhC,EAAsC;EAClC,MAAMC,QAAQ,GAAGC,WAAW,CAACR,GAAD,CAA5B;EAAA,MACIS,UAAU,GAAGV,aAAa,CAACQ,QAAD,CAD9B;EAEA,SAAOJ,KAAK,CAACO,MAAN,CAAaD,UAAb,EAAyB;EAAEH,IAAAA,IAAI,EAAJA,IAAF;EAAQ3B,IAAAA,IAAI,EAAEqB;EAAd,GAAzB,CAAP;EACH;;EAED,SAASQ,WAAT,CAAqBR,GAArB,EAA0B;EACtB,SAAOnB,iBAAiB,CAACmB,GAAD,CAAjB,CAAuB,CAAvB,CAAP;EACH;;EAED,SAASW,aAAT,CAAuBlB,MAAvB,EAA+BmB,IAA/B,EAAqC;EACjCA,EAAAA,IAAI,GAAGA,IAAI,IAAIC,MAAM,CAACD,IAAP,CAAYC,MAAM,CAACpB,MAAD,CAAlB,CAAf;EACA,MAAIU,KAAK,GAAG,IAAZ;;EACA,MAAIS,IAAI,IAAIA,IAAI,CAACxB,MAAjB,EAAyB;EACrB,QAAMgB,KAAK,GAAG,EAAd;EAAA,QACIU,SAAS,GAAG,EADhB;EADqB;EAAA;EAAA;;EAAA;EAAA;EAAA,YAGZd,GAHY;EAIjBI,QAAAA,KAAK,CAACJ,GAAD,CAAL,GAAaP,MAAM,CAACO,GAAD,CAAnB;EACA,YAAIS,UAAU,GAAGV,aAAa,CAACC,GAAD,CAA9B;;EACAc,QAAAA,SAAS,CAACL,UAAD,CAAT,GAAwB,UAASL,KAAT,EAA8B;EAAA,cAAdW,OAAc,uEAAJ,EAAI;EAClD,cAAIpC,IAAI,GAAGoC,OAAO,CAACpC,IAAR,IAAgBqB,GAA3B;EAAA,cACIM,IAAI,GAAGS,OAAO,CAACT,IAAR,IAAgB,IAD3B;EAEA3B,UAAAA,IAAI,GAAGA,IAAI,IAAIqB,GAAf;;EACA,cAAIgB,cAAc,CAACC,IAAf,CAAoBF,OAApB,EAA6B,MAA7B,CAAJ,EAA0C;EACtCvB,YAAAA,OAAO,CAACY,KAAD,EAAQzB,IAAR,EAAc2B,IAAd,CAAP;EACH;EACJ,SAPD;EANiB;;EAGrB,4BAAgBM,IAAhB,mIAAsB;EAAA;EAWrB;EAdoB;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;;EAerBT,IAAAA,KAAK,GAAG,IAAIe,IAAI,CAACC,KAAT,CAAe;EAAEf,MAAAA,KAAK,EAALA,KAAF;EAASU,MAAAA,SAAS,EAATA;EAAT,KAAf,CAAR;EACH;;EACD,SAAOX,KAAP;EACH;;EAED,SAASiB,SAAT,CAAmB3B,MAAnB,EAA2B;EACvBA,EAAAA,MAAM,GAAGoB,MAAM,CAACpB,MAAD,CAAf;;EACA,MAAMmB,IAAI,GAAGC,MAAM,CAACD,IAAP,CAAYnB,MAAZ,CAAb;EAAA,MACIU,KAAK,GAAGQ,aAAa,CAAClB,MAAD,EAASmB,IAAT,CADzB;EAAA,MAEIS,YAAY,GAAG,SAASA,YAAT,CAAsBrB,GAAtB,EAA2B;EACtCa,IAAAA,MAAM,CAACS,cAAP,CAAsB7B,MAAtB,EAA8BO,GAA9B,EAAmC;EAC/BuB,MAAAA,GAD+B,iBACzB;EACF,eAAOrB,YAAY,CAACC,KAAD,EAAQH,GAAR,CAAnB;EACH,OAH8B;EAI/BwB,MAAAA,GAJ+B,eAI3BC,MAJ2B,EAInB;EACR,YAAI,QAAOA,MAAP,MAAkB,QAAtB,EAAgC;EAC5BA,UAAAA,MAAM,GAAGZ,MAAM,CAACa,MAAP,CAAc,EAAd,EAAkBD,MAAlB,CAAT;EACH;;EACDpB,QAAAA,UAAU,CAACF,KAAD,EAAQH,GAAR,EAAayB,MAAb,CAAV;EACH;EAT8B,KAAnC;EAWH,GAdL;;EAeA,wBAAgBb,IAAhB,eAAsB;EAAjB,QAAIZ,GAAG,GAAIY,IAAJ,IAAP;EACDS,IAAAA,YAAY,CAACrB,GAAD,CAAZ;EACH;;EACD,SAAOG,KAAP;EACH;;EAED,SAASwB,cAAT,CAAwBC,WAAxB,EAAqC;EACjC,MAAMC,SAAS,GAAG,IAAID,WAAJ,EAAlB;EAAA,MACIzB,KAAK,GAAGiB,SAAS,CAACS,SAAD,CADrB;;EAEA,MAAMC,KAAK,GAAG,SAASA,KAAT,GAAiB;EAAA,eACVjB,MAAM,CAACD,IAAP,CAAYiB,SAAZ,CADU;;EAC3B,gDAAyC;EAApC,UAAIE,IAAI,YAAR;EACDlB,MAAAA,MAAM,CAACS,cAAP,CACI,IADJ,EAEIS,IAFJ,EAGIlB,MAAM,CAACmB,wBAAP,CAAgCH,SAAhC,EAA2CE,IAA3C,CAHJ;EAKH;EACJ,GARD;;EASAD,EAAAA,KAAK,CAACG,SAAN,GAAkBpB,MAAM,CAACqB,MAAP,CAAcN,WAAW,CAACK,SAA1B,CAAlB;EACAH,EAAAA,KAAK,CAACG,SAAN,CAAgBE,WAAhB,GAA8BP,WAAW,CAACK,SAAZ,CAAsBE,WAApD;EACAL,EAAAA,KAAK,CAACM,aAAN,GAAsBjC,KAAtB;EACA,SAAO2B,KAAP;EACH;;EAED,SAASO,eAAT,CAAyBtB,OAAzB,EAAkC;EAC9BK,EAAAA,SAAS,CAACL,OAAD,CAAT;EACA,SAAOA,OAAP;EACH;;EAED,SAASI,KAAT,GAA6B;EAAA,MAAdJ,OAAc,uEAAJ,EAAI;;EACzB,MAAI,CAACtC,WAAL,EAAkB;EACd6D,IAAAA,GAAG,CAACC,GAAJ,CAAQrB,IAAR;EACAzC,IAAAA,WAAW,GAAG,IAAd;EACH;;EACD,MAAI,OAAOsC,OAAP,KAAmB,UAAvB,EAAmC;EAC/B,WAAOY,cAAc,CAACZ,OAAD,CAArB;EACH,GAFD,MAEO;EACH,WAAOsB,eAAe,CAACtB,OAAD,CAAtB;EACH;EACJ;;;;;;;;;;;;"}