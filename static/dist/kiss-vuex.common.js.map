{"version":3,"file":"kiss-vuex.common.js","sources":["../src/Store.js"],"sourcesContent":["import Vue from \"vue\";\nimport Vuex from \"vuex\";\n\nlet vuexHasUsed = false;\n\nfunction __isKey__(path) {\n    return [\"string\", \"number\", \"symbol\", \"bigint\"].indexOf(typeof path) > -1;\n}\n\nfunction __normalizePath__(path) {\n    let finalPaths = [];\n    if (__isKey__(path)) {\n        path = String(path)\n            .replace(\"[\", \".\")\n            .replace(\"]\", \".\")\n            .split(\".\");\n    }\n    if (Array.isArray(path) && path.length) {\n        for (let p of path) {\n            if (p.indexOf(\".\") > -1) {\n                finalPaths = finalPaths.concat(__normalizePath__(p));\n            } else if (p || p == \"0\") {\n                finalPaths.push(p);\n            }\n        }\n    }\n    return finalPaths;\n}\n\nfunction __set__(object, path, value) {\n    const rawObj = object;\n    if (object && typeof object === \"object\") {\n        path = __normalizePath__(path);\n        const length = path.length;\n        for (let i = 0; i < length; i++) {\n            if (i >= length - 1) {\n                object[path[i]] = value;\n            } else if (typeof object[path[i]] === \"object\") {\n                object = object[path[i]];\n            } else {\n                object = object[path[i]] = {};\n            }\n        }\n    }\n    return rawObj;\n}\n\nfunction __get__(object, path) {\n    let result = void 0;\n    if (object && typeof object === \"object\") {\n        path = __normalizePath__(path);\n        const length = path.length;\n        if (length) {\n            for (let i = 0; i < length; i++) {\n                if (i >= length - 1) {\n                    result = object[path[i]];\n                } else if (typeof object[path[i]] === \"object\") {\n                    object = object[path[i]];\n                }\n            }\n        }\n    }\n    return result;\n}\n\nfunction genCommitName(key) {\n    if (__isKey__(key)) {\n        return \"SETTER_\" + String(key).toUpperCase();\n    }\n    return \"\";\n}\n\nfunction getFromStore(store, key) {\n    return __get__(store.state, key);\n}\n\nfunction setToStore(store, key, data) {\n    const firstKey = getFirstKey(key),\n        commitName = genCommitName(firstKey);\n    return store.commit(commitName, { data, path: key });\n}\n\nfunction getFirstKey(key) {\n    return __normalizePath__(key)[0];\n}\n\nfunction initVuexStore(object, keys) {\n    keys = keys || Object.keys(Object(object));\n    let store = null;\n    if (keys && keys.length) {\n        const state = {},\n            mutations = {};\n        for (let key of keys) {\n            state[key] = object[key];\n            let commitName = genCommitName(key);\n            mutations[commitName] = function(state, options = {}) {\n                let path = options.path || key,\n                    data = options.data || null;\n                path = path || key;\n                if (hasOwnProperty.call(options, \"data\")) {\n                    __set__(state, path, data);\n                }\n            };\n        }\n        store = new Vuex.Store({ state, mutations });\n    }\n    return store;\n}\n\nfunction makeStore(object) {\n    object = Object(object);\n    const keys = Object.keys(object),\n        store = initVuexStore(object, keys),\n        castReactive = function castReactive(key) {\n            Object.defineProperty(object, key, {\n                get() {\n                    return getFromStore(store, key);\n                },\n                set(newVal) {\n                    if (typeof newVal === \"object\") {\n                        newVal = Object.assign({}, newVal);\n                    }\n                    setToStore(store, key, newVal);\n                }\n            });\n        };\n    for (let key of keys) {\n        castReactive(key);\n    }\n    return store;\n}\n\nfunction makeClassStore(targetClass) {\n    const targetObj = new targetClass(),\n        store = makeStore(targetObj);\n    const Class = function Class() {\n        for (let prop of Object.keys(targetObj)) {\n            Object.defineProperty(\n                this,\n                prop,\n                Object.getOwnPropertyDescriptor(targetObj, prop)\n            );\n        }\n    };\n    Class.prototype = Object.create(targetClass.prototype);\n    Class.prototype.constructor = targetClass.prototype.constructor;\n    Class.__VUE_STORE__ = store;\n    return Class;\n}\n\nfunction makeObjectStore(options) {\n    makeStore(options);\n    return options;\n}\n\nfunction Store(options = {}) {\n    if (!vuexHasUsed) {\n        Vue.use(Vuex);\n        vuexHasUsed = true;\n    }\n    if (typeof options === \"function\") {\n        return makeClassStore(options);\n    } else {\n        return makeObjectStore(options);\n    }\n}\n\nexport {\n    __normalizePath__,\n    __set__,\n    __get__,\n    genCommitName,\n    getFromStore,\n    setToStore,\n    getFirstKey,\n    initVuexStore,\n    makeStore,\n    makeClassStore,\n    makeObjectStore\n};\n\nexport default Store;\n"],"names":["vuexHasUsed","__isKey__","path","indexOf","__normalizePath__","finalPaths","String","replace","split","Array","isArray","length","p","concat","push","__set__","object","value","rawObj","i","__get__","result","genCommitName","key","toUpperCase","getFromStore","store","state","setToStore","data","firstKey","getFirstKey","commitName","commit","initVuexStore","keys","Object","mutations","options","hasOwnProperty","call","Vuex","Store","makeStore","castReactive","defineProperty","get","set","newVal","assign","makeClassStore","targetClass","targetObj","Class","prop","getOwnPropertyDescriptor","prototype","create","constructor","__VUE_STORE__","makeObjectStore","Vue","use"],"mappings":"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"}