{"version":3,"file":"kiss-vuex.esm.js","sources":["../src/Store.js"],"sourcesContent":["import Vue from \"vue\";\nimport Vuex from \"vuex\";\n\nlet vuexHasUsed = false;\n\nfunction __normalizePath__(path) {\n    const finalPaths = [];\n    if (typeof path === \"string\") {\n        path = path.split(\".\");\n    }\n    if (Array.isArray(path) && path.length) {\n        for (let p of path) {\n            if (p || p == 0) {\n                finalPaths.push(p);\n            }\n        }\n    }\n    return finalPaths;\n}\n\nfunction __set__(object, path, value) {\n    if (object && typeof object === \"object\") {\n        path = __normalizePath__(path);\n        const length = path.length;\n        for (let i = 0; i < length; i++) {\n            if (i >= length - 1) {\n                object[path[i]] = value;\n            } else if (typeof object[path[i]] === \"object\") {\n                object = object[path[i]];\n            } else if (object[path[i]] == null) {\n                object = object[path[i]] = {};\n            } else {\n                break;\n            }\n        }\n    }\n}\n\nfunction __get__(object, path) {\n    let result = void 0;\n    if (object && typeof object === \"object\") {\n        path = __normalizePath__(path);\n        const length = path.length;\n        for (let i = 0; i < length; i++) {\n            if (i >= length - 1) {\n                result = object[path[i]];\n            } else if (typeof object[path[i]] === \"object\") {\n                object = object[path[i]];\n            }\n        }\n    }\n    return result;\n}\n\nfunction genCommitName(key) {\n    if (key && typeof key === \"string\") {\n        return \"SETTER_\" + key.toUpperCase();\n    }\n    return \"\";\n}\n\nfunction getFromStore(store, key) {\n    return __get__(store.state, key);\n}\n\nfunction setToStore(store, key, data) {\n    const firstKey = getFirstKey(key),\n        commitName = genCommitName(firstKey);\n    return store.commit(commitName, { data, path: key });\n}\n\nfunction getFirstKey(key) {\n    return __normalizePath__(key)[0];\n}\n\nfunction initVuexStore(object, keys) {\n    keys = keys || Object.keys(Object(object));\n    let store = null;\n    if (keys && keys.length) {\n        const state = {},\n            mutations = {};\n        for (let key of keys) {\n            state[key] = object[key];\n            let commitName = genCommitName(key);\n            mutations[commitName] = function(state, options = {}) {\n                let path = options.path || key,\n                    data = options.data || null;\n                path = path || key;\n                if (hasOwnProperty.call(options, \"data\")) {\n                    __set__(state, path, data);\n                }\n            };\n        }\n        store = new Vuex.Store({ state, mutations });\n    }\n    return store;\n}\n\nfunction makeStore(object) {\n    object = Object(object);\n    const keys = Object.keys(object),\n        store = initVuexStore(object, keys),\n        castReactive = function castReactive(key) {\n            Object.defineProperty(object, key, {\n                get() {\n                    return getFromStore(store, key);\n                },\n                set(newVal) {\n                    setToStore(store, key, newVal);\n                }\n            });\n        };\n    for (let key of keys) {\n        castReactive(key);\n    }\n    return object;\n}\n\nfunction makeClassStore(targetClass) {\n    const targetObj = new targetClass(),\n        store = makeStore(targetObj);\n    const Class = function Class() {\n        for (let prop of Object.keys(targetObj)) {\n            Object.defineProperty(\n                this,\n                prop,\n                Object.getOwnPropertyDescriptor(targetObj, prop)\n            );\n        }\n    };\n    Class.prototype = Object.create(targetClass.prototype);\n    Class.prototype.constructor = targetClass.prototype.constructor;\n    return Class;\n}\n\nfunction makeObjectStore(options) {\n    return makeStore(options);\n}\n\nfunction Store(options = {}) {\n    if (!vuexHasUsed) {\n        Vue.use(Vuex);\n        vuexHasUsed = true;\n    }\n    if (typeof options === \"function\") {\n        return makeClassStore(options);\n    } else {\n        return makeObjectStore(options);\n    }\n}\n\nexport default Store;\n"],"names":["vuexHasUsed","__normalizePath__","path","finalPaths","split","Array","isArray","length","p","push","__set__","object","value","i","__get__","result","genCommitName","key","toUpperCase","getFromStore","store","state","setToStore","data","firstKey","getFirstKey","commitName","commit","initVuexStore","keys","Object","mutations","options","hasOwnProperty","call","Vuex","Store","makeStore","castReactive","defineProperty","get","set","newVal","makeClassStore","targetClass","targetObj","Class","prop","getOwnPropertyDescriptor","prototype","create","constructor","makeObjectStore","Vue","use"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAGA,IAAIA,WAAW,GAAG,KAAlB;;AAEA,SAASC,iBAAT,CAA2BC,IAA3B,EAAiC;MACvBC,UAAU,GAAG,EAAnB;;MACI,OAAOD,IAAP,KAAgB,QAApB,EAA8B;IAC1BA,IAAI,GAAGA,IAAI,CAACE,KAAL,CAAW,GAAX,CAAP;;;MAEAC,KAAK,CAACC,OAAN,CAAcJ,IAAd,KAAuBA,IAAI,CAACK,MAAhC,EAAwC;;;;;;2BACtBL,IAAd,8HAAoB;YAAXM,CAAW;;YACZA,CAAC,IAAIA,CAAC,IAAI,CAAd,EAAiB;UACbL,UAAU,CAACM,IAAX,CAAgBD,CAAhB;;;;;;;;;;;;;;;;;;;SAILL,UAAP;;;AAGJ,SAASO,OAAT,CAAiBC,MAAjB,EAAyBT,IAAzB,EAA+BU,KAA/B,EAAsC;MAC9BD,MAAM,IAAI,QAAOA,MAAP,MAAkB,QAAhC,EAA0C;IACtCT,IAAI,GAAGD,iBAAiB,CAACC,IAAD,CAAxB;QACMK,MAAM,GAAGL,IAAI,CAACK,MAApB;;SACK,IAAIM,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGN,MAApB,EAA4BM,CAAC,EAA7B,EAAiC;UACzBA,CAAC,IAAIN,MAAM,GAAG,CAAlB,EAAqB;QACjBI,MAAM,CAACT,IAAI,CAACW,CAAD,CAAL,CAAN,GAAkBD,KAAlB;OADJ,MAEO,IAAI,QAAOD,MAAM,CAACT,IAAI,CAACW,CAAD,CAAL,CAAb,MAA2B,QAA/B,EAAyC;QAC5CF,MAAM,GAAGA,MAAM,CAACT,IAAI,CAACW,CAAD,CAAL,CAAf;OADG,MAEA,IAAIF,MAAM,CAACT,IAAI,CAACW,CAAD,CAAL,CAAN,IAAmB,IAAvB,EAA6B;QAChCF,MAAM,GAAGA,MAAM,CAACT,IAAI,CAACW,CAAD,CAAL,CAAN,GAAkB,EAA3B;OADG,MAEA;;;;;;;AAOnB,SAASC,OAAT,CAAiBH,MAAjB,EAAyBT,IAAzB,EAA+B;MACvBa,MAAM,GAAG,KAAK,CAAlB;;MACIJ,MAAM,IAAI,QAAOA,MAAP,MAAkB,QAAhC,EAA0C;IACtCT,IAAI,GAAGD,iBAAiB,CAACC,IAAD,CAAxB;QACMK,MAAM,GAAGL,IAAI,CAACK,MAApB;;SACK,IAAIM,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGN,MAApB,EAA4BM,CAAC,EAA7B,EAAiC;UACzBA,CAAC,IAAIN,MAAM,GAAG,CAAlB,EAAqB;QACjBQ,MAAM,GAAGJ,MAAM,CAACT,IAAI,CAACW,CAAD,CAAL,CAAf;OADJ,MAEO,IAAI,QAAOF,MAAM,CAACT,IAAI,CAACW,CAAD,CAAL,CAAb,MAA2B,QAA/B,EAAyC;QAC5CF,MAAM,GAAGA,MAAM,CAACT,IAAI,CAACW,CAAD,CAAL,CAAf;;;;;SAILE,MAAP;;;AAGJ,SAASC,aAAT,CAAuBC,GAAvB,EAA4B;MACpBA,GAAG,IAAI,OAAOA,GAAP,KAAe,QAA1B,EAAoC;WACzB,YAAYA,GAAG,CAACC,WAAJ,EAAnB;;;SAEG,EAAP;;;AAGJ,SAASC,YAAT,CAAsBC,KAAtB,EAA6BH,GAA7B,EAAkC;SACvBH,OAAO,CAACM,KAAK,CAACC,KAAP,EAAcJ,GAAd,CAAd;;;AAGJ,SAASK,UAAT,CAAoBF,KAApB,EAA2BH,GAA3B,EAAgCM,IAAhC,EAAsC;MAC5BC,QAAQ,GAAGC,WAAW,CAACR,GAAD,CAA5B;MACIS,UAAU,GAAGV,aAAa,CAACQ,QAAD,CAD9B;SAEOJ,KAAK,CAACO,MAAN,CAAaD,UAAb,EAAyB;IAAEH,IAAI,EAAJA,IAAF;IAAQrB,IAAI,EAAEe;GAAvC,CAAP;;;AAGJ,SAASQ,WAAT,CAAqBR,GAArB,EAA0B;SACfhB,iBAAiB,CAACgB,GAAD,CAAjB,CAAuB,CAAvB,CAAP;;;AAGJ,SAASW,aAAT,CAAuBjB,MAAvB,EAA+BkB,IAA/B,EAAqC;EACjCA,IAAI,GAAGA,IAAI,IAAIC,MAAM,CAACD,IAAP,CAAYC,MAAM,CAACnB,MAAD,CAAlB,CAAf;MACIS,KAAK,GAAG,IAAZ;;MACIS,IAAI,IAAIA,IAAI,CAACtB,MAAjB,EAAyB;QACfc,KAAK,GAAG,EAAd;QACIU,SAAS,GAAG,EADhB;;;;;;;YAESd,GAHY;QAIjBI,KAAK,CAACJ,GAAD,CAAL,GAAaN,MAAM,CAACM,GAAD,CAAnB;YACIS,UAAU,GAAGV,aAAa,CAACC,GAAD,CAA9B;;QACAc,SAAS,CAACL,UAAD,CAAT,GAAwB,UAASL,KAAT,EAA8B;cAAdW,OAAc,uEAAJ,EAAI;cAC9C9B,IAAI,GAAG8B,OAAO,CAAC9B,IAAR,IAAgBe,GAA3B;cACIM,IAAI,GAAGS,OAAO,CAACT,IAAR,IAAgB,IAD3B;UAEArB,IAAI,GAAGA,IAAI,IAAIe,GAAf;;cACIgB,cAAc,CAACC,IAAf,CAAoBF,OAApB,EAA6B,MAA7B,CAAJ,EAA0C;YACtCtB,OAAO,CAACW,KAAD,EAAQnB,IAAR,EAAcqB,IAAd,CAAP;;SALR;;;4BAHYM,IAAhB,mIAAsB;;;;;;;;;;;;;;;;;;IAYtBT,KAAK,GAAG,IAAIe,IAAI,CAACC,KAAT,CAAe;MAAEf,KAAK,EAALA,KAAF;MAASU,SAAS,EAATA;KAAxB,CAAR;;;SAEGX,KAAP;;;AAGJ,SAASiB,SAAT,CAAmB1B,MAAnB,EAA2B;EACvBA,MAAM,GAAGmB,MAAM,CAACnB,MAAD,CAAf;;MACMkB,IAAI,GAAGC,MAAM,CAACD,IAAP,CAAYlB,MAAZ,CAAb;MACIS,KAAK,GAAGQ,aAAa,CAACjB,MAAD,EAASkB,IAAT,CADzB;MAEIS,YAAY,GAAG,SAASA,YAAT,CAAsBrB,GAAtB,EAA2B;IACtCa,MAAM,CAACS,cAAP,CAAsB5B,MAAtB,EAA8BM,GAA9B,EAAmC;MAC/BuB,GAD+B,iBACzB;eACKrB,YAAY,CAACC,KAAD,EAAQH,GAAR,CAAnB;OAF2B;MAI/BwB,GAJ+B,eAI3BC,MAJ2B,EAInB;QACRpB,UAAU,CAACF,KAAD,EAAQH,GAAR,EAAayB,MAAb,CAAV;;KALR;GAHR;;wBAYgBb,IAAhB,eAAsB;QAAbZ,GAAG,GAAIY,IAAJ,IAAP;IACDS,YAAY,CAACrB,GAAD,CAAZ;;;SAEGN,MAAP;;;AAGJ,SAASgC,cAAT,CAAwBC,WAAxB,EAAqC;MAC3BC,SAAS,GAAG,IAAID,WAAJ,EAAlB;MACIxB,KAAK,GAAGiB,SAAS,CAACQ,SAAD,CADrB;;MAEMC,KAAK,GAAG,SAASA,KAAT,GAAiB;eACVhB,MAAM,CAACD,IAAP,CAAYgB,SAAZ,CADU;;gDACc;UAAhCE,IAAI,YAAR;MACDjB,MAAM,CAACS,cAAP,CACI,IADJ,EAEIQ,IAFJ,EAGIjB,MAAM,CAACkB,wBAAP,CAAgCH,SAAhC,EAA2CE,IAA3C,CAHJ;;GAFR;;EASAD,KAAK,CAACG,SAAN,GAAkBnB,MAAM,CAACoB,MAAP,CAAcN,WAAW,CAACK,SAA1B,CAAlB;EACAH,KAAK,CAACG,SAAN,CAAgBE,WAAhB,GAA8BP,WAAW,CAACK,SAAZ,CAAsBE,WAApD;SACOL,KAAP;;;AAGJ,SAASM,eAAT,CAAyBpB,OAAzB,EAAkC;SACvBK,SAAS,CAACL,OAAD,CAAhB;;;AAGJ,SAASI,KAAT,GAA6B;MAAdJ,OAAc,uEAAJ,EAAI;;MACrB,CAAChC,WAAL,EAAkB;IACdqD,GAAG,CAACC,GAAJ,CAAQnB,IAAR;IACAnC,WAAW,GAAG,IAAd;;;MAEA,OAAOgC,OAAP,KAAmB,UAAvB,EAAmC;WACxBW,cAAc,CAACX,OAAD,CAArB;GADJ,MAEO;WACIoB,eAAe,CAACpB,OAAD,CAAtB;;;;;;"}