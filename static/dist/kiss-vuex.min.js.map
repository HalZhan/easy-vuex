{"version":3,"file":"kiss-vuex.min.js","sources":["../src/Store.js"],"sourcesContent":["import Vue from \"vue\";\nimport Vuex from \"vuex\";\n\nlet vuexHasUsed = false;\n\nfunction __normalizePath__(path) {\n    const finalPaths = [];\n    if (typeof path === \"string\") {\n        path = path.split(\".\");\n    }\n    if (Array.isArray(path) && path.length) {\n        for (let p of path) {\n            if (p || p == 0) {\n                finalPaths.push(p);\n            }\n        }\n    }\n    return finalPaths;\n}\n\nfunction __set__(object, path, value) {\n    if (object && typeof object === \"object\") {\n        path = __normalizePath__(path);\n        const length = path.length;\n        for (let i = 0; i < length; i++) {\n            if (i >= length - 1) {\n                object[path[i]] = value;\n            } else if (typeof object[path[i]] === \"object\") {\n                object = object[path[i]];\n            } else if (object[path[i]] == null) {\n                object = object[path[i]] = {};\n            } else {\n                break;\n            }\n        }\n    }\n}\n\nfunction __get__(object, path) {\n    let result = void 0;\n    if (object && typeof object === \"object\") {\n        path = __normalizePath__(path);\n        const length = path.length;\n        for (let i = 0; i < length; i++) {\n            if (i >= length - 1) {\n                result = object[path[i]];\n            } else if (typeof object[path[i]] === \"object\") {\n                object = object[path[i]];\n            }\n        }\n    }\n    return result;\n}\n\nfunction genCommitName(key) {\n    if (key && typeof key === \"string\") {\n        return \"SETTER_\" + key.toUpperCase();\n    }\n    return \"\";\n}\n\nfunction getFromStore(store, key) {\n    return __get__(store.state, key);\n}\n\nfunction setToStore(store, key, data) {\n    const firstKey = getFirstKey(key),\n        commitName = genCommitName(firstKey);\n    return store.commit(commitName, { data, path: key });\n}\n\nfunction getFirstKey(key) {\n    return __normalizePath__(key)[0];\n}\n\nfunction initVuexStore(object, keys) {\n    keys = keys || Object.keys(Object(object));\n    let store = null;\n    if (keys && keys.length) {\n        const state = {},\n            mutations = {};\n        for (let key of keys) {\n            state[key] = object[key];\n            let commitName = genCommitName(key);\n            mutations[commitName] = function(state, options = {}) {\n                let path = options.path || key,\n                    data = options.data || null;\n                path = path || key;\n                if (hasOwnProperty.call(options, \"data\")) {\n                    __set__(state, path, data);\n                }\n            };\n        }\n        store = new Vuex.Store({ state, mutations });\n    }\n    return store;\n}\n\nfunction makeStore(object) {\n    object = Object(object);\n    const keys = Object.keys(object),\n        store = initVuexStore(object, keys),\n        castReactive = function castReactive(key) {\n            Object.defineProperty(object, key, {\n                get() {\n                    return getFromStore(store, key);\n                },\n                set(newVal) {\n                    setToStore(store, key, newVal);\n                }\n            });\n        };\n    for (let key of keys) {\n        castReactive(key);\n    }\n    return object;\n}\n\nfunction makeClassStore(targetClass) {\n    const targetObj = new targetClass(),\n        store = makeStore(targetObj);\n    const Class = function Class() {\n        for (let prop of Object.keys(targetObj)) {\n            Object.defineProperty(\n                this,\n                prop,\n                Object.getOwnPropertyDescriptor(targetObj, prop)\n            );\n        }\n    };\n    Class.prototype = Object.create(targetClass.prototype);\n    Class.prototype.constructor = targetClass.prototype.constructor;\n    return Class;\n}\n\nfunction makeObjectStore(options) {\n    return makeStore(options);\n}\n\nfunction Store(options = {}) {\n    if (!vuexHasUsed) {\n        Vue.use(Vuex);\n        vuexHasUsed = true;\n    }\n    if (typeof options === \"function\") {\n        return makeClassStore(options);\n    } else {\n        return makeObjectStore(options);\n    }\n}\n\nexport default Store;\n"],"names":["vuexHasUsed","__normalizePath__","path","finalPaths","split","Array","isArray","length","p","push","genCommitName","key","toUpperCase","getFromStore","store","object","result","_typeof","i","__get__","state","setToStore","data","commitName","commit","initVuexStore","keys","Object","mutations","options","hasOwnProperty","call","value","__set__","Vuex","Store","makeStore","castReactive","defineProperty","get","set","newVal","targetClass","targetObj","Class","Vue","use","prop","this","getOwnPropertyDescriptor","prototype","create","constructor"],"mappings":"qlBAGA,IAAIA,GAAc,EAElB,SAASC,EAAkBC,OACjBC,EAAa,MACC,iBAATD,IACPA,EAAOA,EAAKE,MAAM,MAElBC,MAAMC,QAAQJ,IAASA,EAAKK,OAAQ,wCACtBL,iDAAM,KAAXM,WACDA,GAAU,GAALA,IACLL,EAAWM,KAAKD,8FAIrBL,EAqCX,SAASO,EAAcC,UACfA,GAAsB,iBAARA,EACP,UAAYA,EAAIC,cAEpB,GAGX,SAASC,EAAaC,EAAOH,UAvB7B,SAAiBI,EAAQb,OACjBc,OAAS,KACTD,GAA4B,WAAlBE,EAAOF,WAEXR,GADNL,EAAOD,EAAkBC,IACLK,OACXW,EAAI,EAAGA,EAAIX,EAAQW,IACfX,EAAS,GAAdW,EACAF,EAASD,EAAOb,EAAKgB,IACa,WAA3BD,EAAOF,EAAOb,EAAKgB,OAC1BH,EAASA,EAAOb,EAAKgB,YAI1BF,EAWAG,CAAQL,EAAMM,MAAOT,GAGhC,SAASU,EAAWP,EAAOH,EAAKW,OAExBC,EAAab,EAKVT,EANsBU,GAMC,WAJvBG,EAAMU,OAAOD,EAAY,CAAED,KAAAA,EAAMpB,KAAMS,IAOlD,SAASc,EAAcV,EAAQW,OAEvBZ,EAAQ,SADZY,EAAOA,GAAQC,OAAOD,KAAKC,OAAOZ,MAEtBW,EAAKnB,OAAQ,KACfa,EAAQ,GACVQ,EAAY,qDACPjB,UACLS,EAAMT,GAAOI,EAAOJ,OAChBY,EAAab,EAAcC,GAC/BiB,EAAUL,GAAc,SAASH,OAAOS,yDAAU,GAC1C3B,EAAO2B,EAAQ3B,MAAQS,EACvBW,EAAOO,EAAQP,MAAQ,KAC3BpB,EAAOA,GAAQS,EACXmB,eAAeC,KAAKF,EAAS,SApEjD,SAAiBd,EAAQb,EAAM8B,MACvBjB,GAA4B,WAAlBE,EAAOF,WAEXR,GADNL,EAAOD,EAAkBC,IACLK,OACXW,EAAI,EAAGA,EAAIX,EAAQW,OACfX,EAAS,GAAdW,EACAH,EAAOb,EAAKgB,IAAMc,OACf,GAA+B,WAA3Bf,EAAOF,EAAOb,EAAKgB,KAC1BH,EAASA,EAAOb,EAAKgB,QAClB,CAAA,GAAuB,MAAnBH,EAAOb,EAAKgB,UACnBH,EAASA,EAAOb,EAAKgB,IAAM,IA2DvBe,CAAQb,EAAOlB,EAAMoB,OARjBI,uIAYhBZ,EAAQ,IAAIoB,EAAKC,MAAM,CAAEf,MAAAA,EAAOQ,UAAAA,WAE7Bd,EAGX,SAASsB,EAAUrB,GACfA,EAASY,OAAOZ,WACVW,EAAOC,OAAOD,KAAKX,GACrBD,EAAQW,EAAcV,EAAQW,GAC9BW,EAAe,SAAsB1B,GACjCgB,OAAOW,eAAevB,EAAQJ,EAAK,CAC/B4B,sBACW1B,EAAaC,EAAOH,IAE/B6B,aAAIC,GACApB,EAAWP,EAAOH,EAAK8B,aAIvBf,aAAM,CAClBW,EADYX,aAGTX,UAwBX,eArBwB2B,EACdC,EAEAC,EAkBKf,yDAAU,UAChB7B,IACD6C,EAAIC,IAAIZ,GACRlC,GAAc,GAEK,mBAAZ6B,GAxBCO,EADNO,EAAY,IADED,EA2BMb,MAxBpBe,EAAQ,qBACOjB,OAAOD,KAAKiB,sBAAY,KAAhCI,OACLpB,OAAOW,eACHU,KACAD,EACApB,OAAOsB,yBAAyBN,EAAWI,OAIjDG,UAAYvB,OAAOwB,OAAOT,EAAYQ,YAC5BE,YAAcV,EAAYQ,UAAUE,YAC7CR,GAIAR,EAWoBP"}