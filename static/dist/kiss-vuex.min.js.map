{"version":3,"file":"kiss-vuex.min.js","sources":["../src/Store.js"],"sourcesContent":["import Vue from \"vue\";\nimport Vuex from \"vuex\";\n\nlet vuexHasUsed = false;\n\nfunction __isKey__(path) {\n    return [\"string\", \"number\", \"symbol\", \"bigint\"].indexOf(typeof path) > -1;\n}\n\nfunction __normalizePath__(path) {\n    let finalPaths = [];\n    if (__isKey__(path)) {\n        path = String(path)\n            .replace(\"[\", \".\")\n            .replace(\"]\", \".\")\n            .split(\".\");\n    }\n    if (Array.isArray(path) && path.length) {\n        for (let p of path) {\n            if (p.indexOf(\".\") > -1) {\n                finalPaths = finalPaths.concat(__normalizePath__(p));\n            } else if (p || p == \"0\") {\n                finalPaths.push(p);\n            }\n        }\n    }\n    return finalPaths;\n}\n\nfunction __set__(object, path, value) {\n    const rawObj = object;\n    if (object && typeof object === \"object\") {\n        path = __normalizePath__(path);\n        const length = path.length;\n        for (let i = 0; i < length; i++) {\n            if (i >= length - 1) {\n                object[path[i]] = value;\n            } else if (typeof object[path[i]] === \"object\") {\n                object = object[path[i]];\n            } else {\n                object = object[path[i]] = {};\n            }\n        }\n    }\n    return rawObj;\n}\n\nfunction __get__(object, path) {\n    let result = void 0;\n    if (object && typeof object === \"object\") {\n        path = __normalizePath__(path);\n        const length = path.length;\n        if (length) {\n            for (let i = 0; i < length; i++) {\n                if (i >= length - 1) {\n                    result = object[path[i]];\n                } else if (typeof object[path[i]] === \"object\") {\n                    object = object[path[i]];\n                }\n            }\n        }\n    }\n    return result;\n}\n\nfunction genCommitName(key) {\n    if (__isKey__(key)) {\n        return \"SETTER_\" + String(key).toUpperCase();\n    }\n    return \"\";\n}\n\nfunction getFromStore(store, key) {\n    return __get__(store.state, key);\n}\n\nfunction setToStore(store, key, data) {\n    const firstKey = getFirstKey(key),\n        commitName = genCommitName(firstKey);\n    return store.commit(commitName, { data, path: key });\n}\n\nfunction getFirstKey(key) {\n    return __normalizePath__(key)[0];\n}\n\nfunction initVuexStore(object, keys) {\n    keys = keys || Object.keys(Object(object));\n    let store = null;\n    if (keys && keys.length) {\n        const state = {},\n            mutations = {};\n        for (let key of keys) {\n            state[key] = object[key];\n            let commitName = genCommitName(key);\n            mutations[commitName] = function(state, options = {}) {\n                let path = options.path || key,\n                    data = options.data || null;\n                path = path || key;\n                if (hasOwnProperty.call(options, \"data\")) {\n                    __set__(state, path, data);\n                }\n            };\n        }\n        store = new Vuex.Store({ state, mutations });\n    }\n    return store;\n}\n\nfunction makeStore(object) {\n    object = Object(object);\n    const keys = Object.keys(object),\n        store = initVuexStore(object, keys),\n        castReactive = function castReactive(key) {\n            Object.defineProperty(object, key, {\n                get() {\n                    return getFromStore(store, key);\n                },\n                set(newVal) {\n                    if (typeof newVal === \"object\") {\n                        newVal = Object.assign({}, newVal);\n                    }\n                    setToStore(store, key, newVal);\n                }\n            });\n        };\n    for (let key of keys) {\n        castReactive(key);\n    }\n    return store;\n}\n\nfunction makeClassStore(targetClass) {\n    const targetObj = new targetClass(),\n        store = makeStore(targetObj);\n    const Class = function Class() {\n        for (let prop of Object.keys(targetObj)) {\n            Object.defineProperty(\n                this,\n                prop,\n                Object.getOwnPropertyDescriptor(targetObj, prop)\n            );\n        }\n    };\n    Class.prototype = Object.create(targetClass.prototype);\n    Class.prototype.constructor = targetClass.prototype.constructor;\n    Class.__VUE_STORE__ = store;\n    return Class;\n}\n\nfunction makeObjectStore(options) {\n    makeStore(options);\n    return options;\n}\n\nfunction Store(options = {}) {\n    if (!vuexHasUsed) {\n        Vue.use(Vuex);\n        vuexHasUsed = true;\n    }\n    if (typeof options === \"function\") {\n        return makeClassStore(options);\n    } else {\n        return makeObjectStore(options);\n    }\n}\n\nexport {\n    __normalizePath__,\n    __set__,\n    __get__,\n    genCommitName,\n    getFromStore,\n    setToStore,\n    getFirstKey,\n    initVuexStore,\n    makeStore,\n    makeClassStore,\n    makeObjectStore\n};\n\nexport default Store;\n"],"names":["vuexHasUsed","__isKey__","path","indexOf","__normalizePath__","finalPaths","String","replace","split","Array","isArray","length","p","concat","push","genCommitName","key","toUpperCase","getFromStore","store","object","result","_typeof","i","__get__","state","setToStore","data","commitName","commit","initVuexStore","keys","Object","mutations","options","hasOwnProperty","call","value","rawObj","__set__","Vuex","Store","makeStore","castReactive","defineProperty","get","set","newVal","assign","targetClass","targetObj","Class","Vue","use","prop","this","getOwnPropertyDescriptor","prototype","create","constructor","__VUE_STORE__"],"mappings":"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"}